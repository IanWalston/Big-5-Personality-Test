<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Big 5 / Five Factor Model Personality Test</title>
    <!-- Latest compiled and minified CSS & JS -->
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
  </head>

  <body>
    <div class="container mt-4">
      <div id="display"></div>
      <button id="btn"></button> <input id="input" />
    </div>

    <script type="text/javascript">
      let question_list = [];
      let answers = [];
      let scorearray = [];

      //get the test
      $.get("/test.json", function(data) {
        $("#display").append(
          $("<button>").on("click", () => {
            //this is where we turn the answers object into a string, then make a request to the server to score our test
            score_string = answers.join(",").slice(1, -2);
            console.log(score_string.length);

            $.get("/score/" + score_string, function(data) {
              console.log(data);
            });
          })
        );

        // console.log(data)
        question_list = data.questions;
        console.log(question_list);

        question_list.forEach(question => {
          const num = question.questionNumber;
          const rev = question.reversed;

          //making the radio components write to the answers object
          $("#display")
            .append(
              `<h2>${JSON.stringify(question.question)}</h2><br><form>
    <label class="radio-inline" >
      <input type="radio" name="optradio" onclick="(${rev})?answers[${num}] = 5:answers[${num}] = 1">Very Inaccurate
    </label>
    <label class="radio-inline">
      <input type="radio" name="optradio" onclick="(${rev})?answers[${num}] = 4:answers[${num}] = 2;">Moderately Inaccurate
    </label>
    <label class="radio-inline">
      <input type="radio" name="optradio" onclick="(${rev})?answers[${num}] = 3:answers[${num}] = 3" checked>Neutral
    </label>
    <label class="radio-inline">
      <input type="radio" name="optradio" onclick="(${rev})?answers[${num}] = 2:answers[${num}] = 4">Moderately Accurate
    </label>
    <label class="radio-inline">
      <input type="radio" name="optradio" onclick="(${rev})?answers[${num}] = 1:answers[${num}] = 5">Very Accurate
    </label>
  </form>`
            )
            .append("<br>");

          //setting default answer to neutral in the answer object
          answers[num.slice(0, -1)] = 3;
        });
      });

      $("#btn").on("click", function() {
        var input = $("#input")
          .val()
          .trim();

        // Using a RegEx Pattern to remove spaces from input
        // You can read more about RegEx Patterns later https://www.regexbuddy.com/regex.html
        input = input.replace(/\s+/g, "").toLowerCase();

        $.get("/score/" + input, function(data) {
          console.log(data);
          if (data) {
          } else {
          }
        });
      });
    </script>
  </body>
</html>
